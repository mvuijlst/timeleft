<!DOCTYPE html>
<html lang="nl-BE">

<head>
    <title>Time</title>
    <meta charset="utf-8">

    <script>
        var birthday = new Date(1970, 8, 27, 0, 0, 0, 0);

        var data = {
            "weekdays": [{
                0: "Sunday"
            }, {
                1: "Monday"
            }, {
                2: "Tuesday"
            }, {
                3: "Wednesday"
            }, {
                4: "Thursday"
            }, {
                5: "Friday"
            }, {
                6: "Saturday"
            }, ],
            "hours": [{
                "Monday": [{
                    "Start": "08:30",
                    "End": "12:00"
                }, {
                    "Start": "12:30",
                    "End": "17:00"
                }]
            }, {
                "Tuesday": [{
                    "Start": "08:30",
                    "End": "12:00"
                }, {
                    "Start": "12:30",
                    "End": "17:00"
                }]
            }, {
                "Wednesday": [{
                    "Start": "08:30",
                    "End": "12:00"
                }, {
                    "Start": "12:30",
                    "End": "17:00"
                }]
            }, {
                "Thursday": [{
                    "Start": "08:30",
                    "End": "12:00"
                }, {
                    "Start": "12:30",
                    "End": "17:00"
                }]
            }, {
                "Friday": [{
                    "Start": "08:30",
                    "End": "12:00"
                }, {
                    "Start": "12:30",
                    "End": "17:00"
                }]
            }, {
                "Saturday": []
            }, {
                "Sunday": []
            }],
            "fixedDaysOff": [{
                "Nieuwjaar": "01-01"
            }, {
                "Dag van de Arbeid": "05-01"
            }, {
                "Nationale feestdag": "07-21"
            }, {
                "O.L.H. Hemelvaart": "08-15"
            }, {
                "Allerheiligen": "11-01"
            }, {
                "Wapenstilstand": "11-11"
            }, {
                "Kerstmis": "12-25"
            }],
            "variableDaysOff": [{
                "Paasmaandag": "2018-04-02"
            }, {
                "O.H. Hemelvaart": "2018-05-10"
            }, {
                "Pinkstermaandag": "2018-05-18"
            }, {
                "Paasmaandag": "2019-04-22"
            }, {
                "O.H. Hemelvaart": "2019-05-30"
            }, {
                "Pinkstermaandag": "2019-06-10"
            }, {
                "Paasmaandag": "2020-04-13"
            }, {
                "O.H. Hemelvaart": "2020-05-21"
            }, {
                "Pinkstermaandag": "2020-06-01"
            }]
        }

        var d = new Date();

        thisweekday = data.weekdays[d.getDay()][1];

        todayhours = data.hours[thisweekday];

        var starthour = 8;
        var startminutes = 30;
        var endhour = 17;
        var endminutes = 00;
        var workminutes = endhour * 60 + endminutes - starthour * 60 - startminutes

        function startTime() {

            var today = new Date();
            var yy = today.getFullYear();
            var mm = today.getMonth();
            var dd = today.getDate();
            var h = today.getHours();
            var m = today.getMinutes();
            var s = today.getSeconds();
            var ms = today.getMilliseconds();



            clearContent("pension");
            addContent("pension", " Ge zijt geboren op " + dateFormat(birthday) + ", wat wil zeggen");
            pensionDate = new Date(birthday.getFullYear() + 67, birthday.getMonth(), birthday.getDate());
            addContent("pension", " dat ge in de regel nog moet werken tot " + dateFormat(pensionDate) + ".");
            untilPensionYears = pensionDate.getFullYear() - yy;
            addContent("pension", " Dat is dus nog " + untilPensionYears + " jaar, of om exact te zijn ");
            untilPensionDays = daysBetween(today, pensionDate);
            addContent("pension", " (schrikkeldagen in acht genomen): " + parseInt(untilPensionDays) + " dagen.");

            clearContent("datetime");
            addContent("datetime", "Het is nu " + h + "u" + doZero(m));
            addContent("datetime", " en " + s + "." + doPad(ms, 3) + " seconden");
            addContent("datetime", " op " + dateFormat(today) + ".");

            if (workTime(today)) {
                addContent("datetime", " Vandaag is het gedaan om " + endhour + "u" + doZero(endminutes) + ".");

                //minute
                millisecondsToEndOfMinute = 60000 - (s * 1000 + ms);
                secondsLeft = parseInt(millisecondsToEndOfMinute / 1000)
                clearContent("minuteleft");
                if (secondsLeft < 1) {
                    addContent("minuteleft", "nog minder dan een seconde ");
                } else if (secondsLeft == 1) {
                    addContent("minuteleft", "nog één seconde ");
                } else {
                    addContent("minuteleft", "nog " + secondsLeft + " seconden ");
                }

                msPercentageMinute = (60000 - millisecondsToEndOfMinute) / 60000 * 100;
                doPercentage("minute", msPercentageMinute);

                //hour
                millisecondsToEndOfHour = 60 * 60 * 1000 - (m * 60 * 1000 + s * 1000 + ms);
                minutesLeft = parseInt(millisecondsToEndOfHour / 1000 / 60);
                clearContent("hourleft");
                if (minutesLeft < 1) {
                    addContent("hourleft", "nog minder dan een minuut ");
                } else if (minutesLeft == 1) {
                    addContent("hourleft", "nog één minuut ");
                } else {
                    addContent("hourleft", "nog " + minutesLeft + " minuten ");
                }
                msPercentageHour = (60 * 60 * 1000 - millisecondsToEndOfHour) / (60 * 60 * 1000) * 100;
                doPercentage("hour", msPercentageHour);

                //day
                endOfDay = new Date(yy, mm, dd, endhour, endminutes, 0);
                milliSecondsToEndOfDay = endOfDay - today;
                clearContent("dayleft");
                hoursLeft = milliSecondsToEndOfDay / 1000 / 60 / 60;
                addContent("dayleft", "nog " + hoursLeft.toPrecision(6) + " uur ");
                msPercentageDay = (workminutes * 60 * 1000 - milliSecondsToEndOfDay) / (workminutes * 60 * 1000) * 100;
                doPercentage("day", msPercentageDay);

                //dayofweek
                startOfDay = new Date(yy, mm, dd, starthour, startminutes, 0);
                millisecondsThisWeek = workminutes * 5 * 60 * 1000;
                millisecondsDoneThisWeek = workminutes * (today.getDay() - 1) * 60 * 1000 + (today - startOfDay);
                clearContent("weekleft");
                minutesLeft = (millisecondsThisWeek - millisecondsDoneThisWeek) / 1000 / 60;
                addContent("weekleft", "nog " + minutesLeft.toPrecision(6) + " minuten ");
                msPercentageDay = (millisecondsDoneThisWeek / millisecondsThisWeek) * 100;
                doPercentage("week", msPercentageDay);

            } else {
                hideContent("page");
                clearContent("off");
                addContent("off", "Ge zoudt niet aan het werken mogen zijn.");
            }

            var t = setTimeout(startTime, 79);
        }

        function workTime(moment) {
            if (moment.getHours() * 60 + moment.getMinutes() < endhour * 60 + endminutes) {
                return true;
            } else {
                return false;
            }
        }

        function doPercentage(cnt, nbr) {
            perc = nbr.toPrecision(5) + "%";
            if (nbr > 10) {
                document.getElementById(cnt).innerHTML = perc + "&nbsp;";
                document.getElementById(cnt + "2").innerHTML = "";
            } else {
                document.getElementById(cnt + "2").innerHTML = "&nbsp;" + perc;
                document.getElementById(cnt).innerHTML = "";
            }
            document.getElementById(cnt).style.width = perc;
        }

        function doZero(i) {
            return i < 10 ? "0" + i : i;
        }

        function doPad(i, ln) {
            return i.toString().length < ln ? "0".repeat(ln - i.toString().length) + i : i;
        }

        function dateFormat(str) {
            var date = new Date(str);
            var montharray = new Array('januari', 'februari', 'maart', 'april', 'mei', 'juni', 'juli', 'augustus', 'september', 'oktober', 'november', 'december');
            var dayarray = new Array('zondag', 'maandag', 'dinsdag', 'woensdag', 'donderdag', 'vrijdag', 'zaterdag');
            return (dayarray[date.getDay()] + ' ' + date.getDate() + ' ' + montharray[date.getMonth()] + ' ' + date.getFullYear());
        }

        function treatAsUTC(date) {
            var result = new Date(date);
            result.setMinutes(result.getMinutes() - result.getTimezoneOffset());
            return result;
        }

        function daysBetween(startDate, endDate) {
            var millisecondsPerDay = 24 * 60 * 60 * 1000;
            return (treatAsUTC(endDate) - treatAsUTC(startDate)) / millisecondsPerDay;
        }

        function hideContent(cnt) {
            document.getElementById(cnt).style.display = "none";
        }

        function clearContent(cnt, str) {
            document.getElementById(cnt).innerHTML = "";
        }

        function addContent(cnt, str) {
            document.getElementById(cnt).innerHTML += str;
        }
    </script>
    <style>
        .progress {
            width: 500px;
            height: 25px;
            padding: 0;
            border-collapse: collapse;
        }
        
        .value {
            background-color: #090;
            color: #fff;
            text-align: right;
            font-size: 0.8em;
        }
        
        .value.left {
            background-color: #900;
            text-align: left;
        }
        
        .white {
            background-color: #fff;
        }
    </style>
</head>

<body onload="startTime()">

    <!-- <h1>Hoe lang nog?</h1> -->
    <p id="pension"></p>
    <p id="datetime"></p>
    <div id="page">
        <table>
            <tr>
                <td>Minuut</td>
                <td>
                    <table class="progress">
                        <tr>
                            <td class="value" id="minute"></td>
                            <td class="value left" id="minute2"></td>
                        </tr>
                    </table>
                </td>
                <td id="minuteleft"></td>
            </tr>
            <tr>
                <td>Uur</td>
                <td>
                    <table class="progress">
                        <tr>
                            <td class="value" id="hour"></td>
                            <td class="value left" id="hour2"></td>
                        </tr>
                    </table>
                </td>
                <td id="hourleft"></td>
            </tr>
            <tr>
                <td>Dag</td>
                <td>
                    <table class="progress">
                        <tr>
                            <td class="value" id="day"></td>
                            <td class="value left" id="day2"></td>
                        </tr>
                    </table>
                </td>
                <td id="dayleft"></td>
            </tr>
            <tr>
                <td>Week</td>
                <td>
                    <table class="progress">
                        <tr>
                            <td class="value" id="week"></td>
                            <td class="value left" id="week2"></td>
                        </tr>
                    </table>
                </td>
                <td id="weekleft"></td>
            </tr>
        </table>
    </div>
    <p id="off"></p>
</body>

</html>